

Social Media Application - Resources & Methods
                                                                                                  i localhost:8080/users
â— Users REST API                                                                                   [
  â–  Retrieve all Users                                                                                -  {
    â—‹ GET/users                                                                                             id: 1,
  â–  Create a User                                                                                           name: "Adam",
    â—‹ POST/users                                                                                            birthDate: "2024-05-18T17:16:30.057+0000"
  â–  Retrieve one User                                                                                    },                                                                                                                                                                           
    â—‹ Get/users/{id}->/users/1                                                                        -  {
  â–  Delete a User                                                                                           id: 2,
    â—‹ DELETE/users/{id}->/users/1                                                                           name: "Eve",
  â–  Posts REST API                                                                                          birthDate: "2024-05-18T17:16:30.057+0000"
    â—‹ Retrieve all posts for a User                                                                      },                                    
      â—¦ GET/users/{id}/posts                                                                        -  {
    â—‹ Create a post for a User                                                                              id: 3,
      â—¦ POST/users/{id}/posts                                                                               name: "Jack",
                                                                                                            birthDate: "2024-05-18T17:16:30.057+0000"
                                                                                                        }                                       
                                                                                                    ]


ì´ë²ˆ í•™ìŠµì€ ê²Œì‹œë¬¼ì— í•„ìš”í•œ REST APIë¥¼ ë§Œë“¤ì–´ë³´ê² ë‹¤
í•œ ì‚¬ìš©ìì˜ ëª¨ë“  ê²Œì‹œë¬¼ì„ ê°€ì ¸ì˜¤ëŠ” API ë¶€í„° ë§Œë“¤ì–´ë³´ì

ì „ì— ì‚´í´ë´¤ë“¯ì´ URLì€ ì´ëŸ° ì‹ì¼ ê²ƒì´ë‹¤, /users/ ë‹¤ìŒì— ì‚¬ìš©ìì˜ IDê°€ ë‚˜ì˜¤ê³  /[postsê°€ ë’¤ì— ì˜¨ë‹¤ 

UserJpaResourceë¡œ ê°€ë³´ì, ì „ì— @DeleteMappingì— ì‚¬ìš©í–ˆë˜ ë©”ì„œë“œë¥¼ ë³µì‚¬í•´ì„œ ì•„ë˜ì— ë¶™ì—¬ë„£ê¸° í•˜ê³ 

---------------------------------------------------------------------------------------------------------------


âº UserJpaResource í´ë˜ìŠ¤íŒŒì¼


package com.in28minutes.rest.webservices.restfulwebservices.user;

import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.*;

import java.net.*;
import java.util.*;

import org.springframework.hateoas.*;
import org.springframework.hateoas.server.mvc.*;
import org.springframework.http.*;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.support.*;

import com.in28minutes.rest.webservices.restfulwebservices.jpa.*;

import jakarta.validation.*;

@RestController
public class UserJpaResource {

//	private UserDaoService service;
	
	private UserRepository repository;
	
	public UserJpaResource(UserDaoService service, UserRepository repository) {
//		this.service = service;
		this.repository = repository;
	}

	@GetMapping("/jpa/users")
	public List<User> retrieveAllUsers() {
		
		return repository.findAll();
	}
	
	//	http://localhost:8080/users
	
	//EntityModel
	//WebMvcLinkBuilder
	
	@GetMapping("/jpa/users/{id}")
	public EntityModel<User> retrieveUser(@PathVariable int id) {
		Optional<User> user = repository.findById(id);
		
		if(user.isEmpty())
			throw new UserNotFoundException("id:"+id);
		
		EntityModel<User> entityModel = EntityModel.of(user.get());
		
		WebMvcLinkBuilder link = linkTo(methodOn(this.getClass()).retrieveAllUsers());
		entityModel.add(link.withRel("all-users"));
		
		return entityModel;

	}

	@DeleteMapping("/jpa/users/{id}")
	public void deleteUser(@PathVariable int id) {
		repository.deleteById(id);
		
	}

  //1:ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ì„ ê°€ì ¸ì™€ì•¼ê² ì§€? ê²Œì‹œë¬¼ ëª©ë¡ List<Post>ê°€ ë°˜í™˜ íƒ€ì…ì´ ëœë‹¤, ë©”ì†Œë“œëª…ì€ retrievePostsForUserë¼ê³ í•˜ê³  
  // /jpa/users/{id}/postsë¥¼ ë„£ìœ¼ë©´ ì´ê²Œ URLì´ ë˜ê³ , ì—¬ê¸°ëŠ” GetMappingì´ ë¼ì•¼í•œë‹¤ Deleteë¥¼ Getìœ¼ë¡œ ë°”ê¿”ì£¼ê² ë‹¤, ì´ë ‡ê²Œ GetMapping("/jpa/users/{id}/posts")ì™€ retrievePostsForUserë¥¼ ìƒì„±í•˜ê³ 
  //ì—¬ê¸°ì— @PathVariableì„ ë„£ì–´ì¤¬ë‹¤ ì¢‹ë‹¤, ë¨¼ì € í•´ì•¼ í•  ì¼ì€ ì‚¬ìš©ìë¥¼ ì°¾ëŠ” ê²ƒì´ë‹¤ retrieveUser()ë©”ì†Œë“œì— ê·¸ì— ë§ëŠ” ì½”ë“œê°€ ìˆë‹¤
	@GetMapping("/jpa/users/{id}/posts")
	public void retrievePostsForUser(@PathVariable int id) {
		
    //1-1: repository.findByIdë¥¼ í˜¸ì¶œí•˜ê³  ì‚¬ìš©ìë¥¼ ëŒë ¤ë°›ëŠ” ê²ƒë¶€í„° í•´ë³´ì, userê°€ ë¹„ì–´ ìˆìœ¼ë©´ 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ' ì˜ˆì™¸ë¥¼ ë˜ì ¸ì•¼ê² ì§€? 
      Optional<User> user = repository.findById(id);
  	//1-2: ì˜ ëœê±° ê°™ë‹¤	
  		if(user.isEmpty())
  			throw new UserNotFoundException("id:"+id);
  
    //1-3: userê°€ ì¡´ì¬í•˜ë©´ í•´ë‹¹ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ê²Œì‹œë¬¼ì„ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤, ê·¸ëŸ¼ User í´ë˜ìŠ¤ë¡œ ë„˜ì–´ê°€ë³¼ê¹Œ?//1-4: Userí´ë˜ìŠ¤íŒŒì¼ë¡œ..
  	//1-5: ì´ì œ user.get().getPostsë¥¼ ì…ë ¥í•œë‹¤, ì´ê²Œ íŠ¹ì • ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ ëª©ë¡ì„ ë°˜í™˜í•  ê²ƒì´ë‹¤, ê·¸ëŸ¼ returnì„ ì…ë ¥í•´ì„œ ì´ ê°’ì„ ë°˜í™˜ ë°›ê³  ì €ì¥í•œë‹¤
    return user.get().getPosts();
	}
	
	@PostMapping("/jpa/users")
	public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
		User savedUser = repository.save(user);
		// /users/4 => /users /{id},  user.getID
		URI location = ServletUriComponentsBuilder.fromCurrentRequest()
						.path("{id}")
						.buildAndExpand(savedUser.getId())
						.toUri();  
		
		return ResponseEntity.created(location).build();
	}
}

-----------------------------------------------------


âº User í´ë˜ìŠ¤íŒŒì¼


package com.in28minutes.rest.webservices.restfulwebservices.user;

import java.time.*;
import java.util.*;

import com.fasterxml.jackson.annotation.*;

import jakarta.persistence.*;
import jakarta.validation.constraints.*;

@Entity(name = "user_details")
public class User {

	protected User() {
		
	}
	
	@Id
	@GeneratedValue
	private Integer id;
	
	@Size(min=2, message = "Name should have atleast 2 characters")
//	@JsonProperty("user_name")
	private String name;
	
	@Past(message = "Birth Date should be in the past")
//	@JsonProperty("birth_date")
	private LocalDate birthDate;
	
	@OneToMany(mappedBy = "user")
	@JsonIgnore
	private List<Post> posts;

	public User(Integer id, String name, LocalDate birthDate) {
		super();
		this.id = id;
		this.name = name;
		this.birthDate = birthDate;
	}

	public Integer getId() {
		return id;
	}

	public void setId(Integer id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public LocalDate getBirthDate() {
		return birthDate;
	}

	public void setBirthDate(LocalDate birthDate) {
		this.birthDate = birthDate;
	}

//1-4: ê²Œì‹œë¬¼ì— ê²Œí„°ë‚˜ ì„¸í„° ë©”ì„œë“œê°€ ì—†ì§€, ë°”ë¡œ ìƒì„±í•´ë³´ê² ë‹¤, ìš°í´ë¦­> Source > Generate Getters and Setters í´ë¦­ ëª¨ë‘ì„ íƒì„ ëˆ„ë¥¸ë‹¤
// ì´ì œ ê²Œí„°ì™€ ì„¸í„°ê°€ ìƒì„±ë˜ì—ˆë‹¤ ì €ì¥í•˜ê³  UserJpaResourceë¡œ ëŒì•„ê°„ë‹¤ //1-5: UserJpaResource í´ë˜ìŠ¤íŒŒì¼ë¡œ..
	public List<Post> getPosts() {
		return posts;
	}
	
	public void setPosts(List<Post> posts) {
		this.posts = posts;
	}

	@Override
	public String toString() {
		return "User [id=" + id + ", name=" + name + ", birthDate=" + birthDate + "]";
	}
	
}
---------------------------------------------------------------------------------------------------------------

ì´ì œ jpa/users/10001ì´ íŠ¹ì • ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤

---------------------------------------------------------------------------------------------------------------

ğŸŒ http://localhost:8080/jpa/users/10001/posts ì‚¬ì´íŠ¸í™”ë©´ ==>

[
  {
    "id": 20001,
    "description": "I want to learn AWS"
  },
  {
    "id": 20002,
    "description": "I want to learn DevOps"
  }
]

---------------------------------------------------------------------------------------------------------------

ê·¸ëŸ¼ ì´ì œ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ê²Œì‹œë¬¼ì„ ê°€ì ¸ì™€ì•¼ê² ì§€
ì´ http://localhost:8080/jpa/users/10001/postsê°€ íŠ¹ì • ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ ì „ì²´ë¥¼ ì œê³µí•œë‹¤




ì´ë²ˆ ë‹¨ê³„ì—ì„  íŠ¹ì • ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ì„ ì „ë¶€ ê°€ì ¸ì˜¤ëŠ” ê°„ë‹¨í•œ REST APIë¥¼ ìƒì„±í–ˆë‹¤
