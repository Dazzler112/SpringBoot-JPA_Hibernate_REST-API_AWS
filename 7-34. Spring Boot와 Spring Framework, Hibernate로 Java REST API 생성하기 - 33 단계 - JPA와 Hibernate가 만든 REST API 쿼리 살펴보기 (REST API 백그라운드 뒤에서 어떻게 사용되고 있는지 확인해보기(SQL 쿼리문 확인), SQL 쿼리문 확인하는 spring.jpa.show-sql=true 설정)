

ì§€ë‚œ ëª‡ ë‹¨ê³„ì— ê±¸ì³ REST APIë¥¼ DBì— ì—°ê²°í–ˆëŠ”ë° 
localhost:8080/jpa/usersë¡œ ê°€ì„œ ì‹¤í–‰í•˜ë©´ 

-----------------------------------------------------------------------------------------------------------------

ğŸŒ http://localhost:8080/jpa/users ì‚¬ì´íŠ¸í™”ë©´ ==>


[
  {
    "id": 10001,
    "name": "Ranga",
    "birthDate": "2024-06-10"
  },
  {
    "id": 10002,
    "name": "Ravi",
    "birthDate": "2024-06-10"
  },
  {
    "id": 10003,
    "name": "Sathish",
    "birthDate": "2024-06-10"
  }
]

-----------------------------------------------------------------------------------------------------------------

ì´ëŸ° ì‘ë‹µì´ ëŒì•„ì˜¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤
ì‘ë‹µìœ¼ë¡œ ëŒì•„ì˜¤ëŠ” ì‚¬ìš©ì ì „ì²´ë¥¼ ë³¼ ìˆ˜ ìˆê³ 
localhost:8080/jpa/users/10001/postsë¥¼ ë³´ë©´

-----------------------------------------------------------------------------------------------------------------

ğŸŒ http://localhost:8080/jpa/users/10001/posts ì‚¬ì´íŠ¸í™”ë©´ ==>


[
  {
    "id": 20001,
    "description": "I want to learn AWS"
  },
  {
    "id": 20002,
    "description": "I want to learn DevOps"
  }
]

-----------------------------------------------------------------------------------------------------------------
í•´ë‹¹ íŠ¹ì • ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤,
ì›í•œë‹¤ë©´ ê°€ì„œ ìƒˆ ê²Œì‹œë¬¼ë„ ìƒì„±í•  ìˆ˜ ìˆë‹¤ 

-----------------------------------------------------------------------------------------------------------------

ğŸ–‡ Talend API Tester í™”ë©´ ==>    (ë” ìì„¸í•œê±´ í¬ë¡¬ í™•ì¥í”„ë¡œê·¸ë¨ Talend API Tester ì‹¤í–‰í•´ì„œ í™•ì¸..)

  METHOD                SCHEME :// HOST [ ":" PORT ] [ PATH [ "?" QUERY ]]
  ______________      ____________________________________________________________    ___________________
 | POST    | â–¼  |    |    http://localhost:8080/jpa/users/10001/posts             |  |  âœˆ Send       | â–½ |
  â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾      â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾    â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
                        â–¶ QUERY PARAMETERS

  HEADERS   â¬‡                   | Form â–¼ |      â—€ | â–¶  BODY                                   | Text â–¼ |
â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾         |   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
   ______________   ___________________________   |   
â˜‘ | Content-Type |:| application/json     | ğŸ§ª |  |     {
   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾   |        "description": "I want to learn Azure Fundamenttals"
  ______________                                  |      }                            
 ( + Add header )   ğŸ— Add authorization     ğŸ—‘    |                                                        
  â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾                                  | 
                                                  |
 â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
                                                

-----------------------------------------------------------------------------------------------------------------

ì˜ˆë¥¼ ë“¤ì–´ 10001 ê²Œì‹œë¬¼ì— ìƒˆ ê²Œì‹œë¬¼ì„ ìƒì„±í•œë‹¤ê³  í•´ë³´ì
ì½˜í…ì¸  íƒ€ì…ì„ application/jsonìœ¼ë¡œ í•´ì„œ POST ìš”ì²­ì„ í•  ìˆ˜ ìˆê³ , ì„¤ëª…ì„
"Azure ê¸°ë³¸ ì‚¬í•­ì„ ë°°ìš°ê³  ì‹¶ë‹¤" ë¼ê³  ë„£ì€ë‹¤ìŒ ì „ì†¡ì„ ëˆ„ë¥´ë©´ ëœë‹¤
                                                      |
                                                      V
-----------------------------------------------------------------------------------------------------------------

ğŸ–‡ Talend API Tester í™”ë©´ ==>    (ë” ìì„¸í•œê±´ í¬ë¡¬ í™•ì¥í”„ë¡œê·¸ë¨ Talend API Tester ì‹¤í–‰í•´ì„œ í™•ì¸..)


  Response
â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
  201                (ì´ˆë¡ ë°”íƒ•)
___________________________________________________________________________________________________

  HEADERS                     | pretty â–¼ |  â—€ | â–¶  BODY                                 | pretty â–¼ |
â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾     |   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
                                              |
Location:	http://localhost:8080/jpa/users/    |
          10001/posts/1                       |                                                                
Content-Length:	0 byte                        |                     No Content 
Date: Mon, 10 Jun 2024 08:18:05 GMT	          |                                                                                
Keep-Alive:	timeout=60                        |                                                 
Connection:	keep-alive                        |                                       
                                              |                  
â–¶ COMPLETE REQUEST HEADERS                    |                                                                                                                    
                                                                                        
                                                                                                    
                                                 ğŸ“„ copy                                                          

-----------------------------------------------------------------------------------------------------------------

    ì´ì œ ì—¬ê¸°ì— ìˆëŠ” ê²Œì‹œë¬¼ì„ ìƒˆë¡œê³ ì¹¨í•˜ë©´             |  
                                                    V
-----------------------------------------------------------------------------------------------------------------

ğŸŒ http://localhost:8080/jpa/users/10001/posts ì‚¬ì´íŠ¸í™”ë©´ ==>


[
  {
    "id": 1,
    "description": "I want to learn React"
  },
  {
    "id": 20001,
    "description": "I want to learn AWS"
  },
  {
    "id": 20002,
    "description": "I want to learn DevOps"
  }
]

-----------------------------------------------------------------------------------------------------------------

ê²Œì‹œë¬¼ 3ê°œê°€ ëŒì•„ì˜¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤,
ì´ ì„¸ë¶€ ì •ë³´ ê°ê°ì€ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ë‹¤ 

localhost:8080/h2-consoleë¡œ ê°€ë©´ DBì— ìˆëŠ” ì„¸ë¶€ ì •ë³´ ì „ì²´ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤ 

-----------------------------------------------------------------------------------------------------------------
H2 Database ì•ˆ ==>

ğŸ”‹ jdbc:h2:mem:testdb
 + ğŸ’· POST
 + ğŸ’· USER_DETAILS
 + ğŸ“ INFORMATION_SCHEMA
 + ğŸ« Sequences
 + ğŸ‘ª Users
 i H2 2.2.224 (2023-09-17)


----------------------------------------------------------------------

âº H2 Console 
 _____   ______________   _______________   _______
| Run | | Run Selected | | Auto complete | | Clear | SQL statement:
 â€¾â€¾â€¾â€¾â€¾   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾   â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾   â€¾â€¾â€¾â€¾â€¾â€¾â€¾ 
 ___________________________________________________________________________________
| SELECT * FROM POST                                                                |
|                                                                                   |                     
|                                                                                   |                     
|                                                                                   |                     
|                                                                                   |                    
|                                                                                   |                     
 â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
SELECT * FROM POST;
 _____________________________________________________
| ID  	| DESCRIPTION                        | USER_ID|
------------------------------------------------------
| 1	    |I want to learn Azure Fundamenttals | 10001	|
------------------------------------------------------
| 20001	|I want to learn AWS                 |10001   |
------------------------------------------------------
| 20002	|I want to learn DevOps              |10001   |
------------------------------------------------------
| 20003	|I want to Get AWS Certified         |10002   |
------------------------------------------------------
| 20004	|I want to learn Multi Cloud         |10002   |
 â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾
(5 rows, 1 ms)
 ____
|Edit|
 â€¾â€¾â€¾â€¾
-----------------------------------------------------------------------------------------------------------------

POST ì—ì„œ SELECT * FROM POST ë¥¼ ì‹¤í–‰í•˜ë©´ 10001ì— ëŒ€í•´ ìƒˆ ê²Œì‹œë¬¼ì´ ì¶”ê°€ëœ ê²Œ ë³´ì¸ë‹¤
ì´ë²ˆ ë‹¨ê³„ì—ì„  ì´ ê°ê°ì˜ API í˜¸ì¶œ ì‹œ ë³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œ ë²Œì–´ì§€ëŠ” ê³¼ì •ì„ ê¹Šì´ íŒŒê³ ë“¤ì–´ ë³¼ ê²ƒì´ë‹¤


ì „ì— appilcation.propertiesì— spring.jpa.show-sql=trueë¥¼ ì¶”ê°€í–ˆì—ˆì§€?

-----------------------------------------------------------------------------------------------------------------

âº application.properties íŒŒì¼

spring.application.name=restful-web-services

logging.level.org.springframework=info

management.endpoints.web.exposure.include=*

spring.datasource.url=jdbc:h2:mem:testdb

spring.jpa.defer-datasource-initialization=true

spring.jpa.show-sql=true

-----------------------------------------------------------------------------------------------------------------

spring.jpa.show-sql=true ì´ ì„¤ì •ì˜ ì—­í• ì€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ëª¨ë“  SQL ì¿¼ë¦¬ë¥¼ ë¡œê·¸ì— ì¶œë ¥í•˜ëŠ” ê²ƒì´ë‹¤
ê·¸ëŸ¼ ë¡œê·¸ë¡œ ë“¤ì–´ê°€ì„œ ì½˜ì†”ì„ ì§€ìš°ê³  ì´ ê°ê°ì˜ APIë¥¼ ë¡œê·¸ì—ì„œ ì‚´í´ë³´ê² ë‹¤

ì˜ˆë¥¼ ë“¤ì–´ ë¨¼ì € localhost:8080/jpa/users ì‹œì‘í•´ë³´ê² ë‹¤ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì§ˆê¹Œ? ìƒˆë¡œ ê³ ì¹¨ì„ ëˆ„ë¥´ê³ 
ì½˜ì†”ì„ ë´ë³´ì
-----------------------------------------------------------------------------------------------------------------

âº sts ì½˜ì†”ì°½ ==>

Hibernate: select u1_0.id,u1_0.birth_date,u1_0.name from user_details u1_0

-----------------------------------------------------------------------------------------------------------------

ì§€ê¸ˆ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì¿¼ë¦¬ê°€ ë­ì§€?
ì§€ê¸ˆ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ë¥¼ ì•Œ ìˆ˜ ìˆëŠ”ë° 
ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ì—ì„œ IDì™€ ìƒë…„ì›”ì¼, ì´ë¦„ì„ SELECT ì¿¼ë¦¬í•˜ê³  ìˆë‹¤ 
ì´ê²Œ ì§€ê¸ˆ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì¿¼ë¦¬ì´ë‹¤

UserJpaResourceë¡œ ë„˜ì–´ê°€ ë³´ë©´ 
ì‹¤í–‰í•˜ëŠ” ì½”ë“œëŠ” ë­ì§€?
repository.findAll()ì´ë‹¤ 

-----------------------------------------------------------------------------------------------------------------


âº UserJpaResource í´ë˜ìŠ¤íŒŒì¼


package com.in28minutes.rest.webservices.restfulwebservices.user;

import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.*;

import java.net.*;
import java.util.*;

import org.springframework.hateoas.*;
import org.springframework.hateoas.server.mvc.*;
import org.springframework.http.*;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.support.*;

import com.in28minutes.rest.webservices.restfulwebservices.jpa.*;

import jakarta.validation.*;

@RestController
public class UserJpaResource {

//	private UserDaoService service;

  //1: ì—¬ê¸°ì—ëŠ” ì‚¬ìš©ì ì €ì¥ì†Œë¥¼ ë‚˜íƒ€ë‚´ëŠ” repositoryê°€ ìˆëŠ”ë° ( private UserRepository repository; )
  // ë§ˆìŒì— ë“¤ì§€ ì•ŠëŠ”ë‹¤ ì´ë¦„ì„ ë°”ê¾¸ê² ë‹¤, ìš°í´ë¦­ í•´ì„œ > Refactor > Rename userRepositoryë¼ê³  í•˜ê² ë‹¤ (repository ì—ì„œ userRepositoryë¡œ ë°”ê¿ˆ)
  //ì´ì œ ì—¬ê¸°ì— userRepositoryê°€ ìˆë‹¤
	private UserRepository userRepository;
	
	private PostRepository postRepository;	

  //1-1: ìƒì„±ì íŒŒë¼ë¯¸í„° ì´ë¦„ë„ userRepositoryë¼ê³  í•´ì£¼ê³ 
	public UserJpaResource(UserRepository userRepository, PostRepository postRepository) {
//		this.service = service;
  
    //1-1 ê³„ì†: ì¼ê´€ì„±ì„ ìœ ì§€í•œë‹¤ (repository -> userRepository)
		this.userRepository = userRepository;
		this.postRepository = postRepository;
	}

	@GetMapping("/jpa/users")
	public List<User> retrieveAllUsers() {
		
		return userRepository.findAll();
	}
	
	//	http://localhost:8080/users
	
	//EntityModel
	//WebMvcLinkBuilder
	
	@GetMapping("/jpa/users/{id}")
	public EntityModel<User> retrieveUser(@PathVariable int id) {
		Optional<User> user = userRepository.findById(id);
		
		if(user.isEmpty())
			throw new UserNotFoundException("id:"+id);
		
		EntityModel<User> entityModel = EntityModel.of(user.get());
		
		WebMvcLinkBuilder link = linkTo(methodOn(this.getClass()).retrieveAllUsers());
		entityModel.add(link.withRel("all-users"));
		
		return entityModel;

	}

	@DeleteMapping("/jpa/users/{id}")
	public void deleteUser(@PathVariable int id) {
		userRepository.deleteById(id);
		
	}
	
	@GetMapping("/jpa/users/{id}/posts")
	public List<Post> retrievePostsForUser(@PathVariable int id) {
		Optional<User> user = userRepository.findById(id);
		
		if(user.isEmpty())
			throw new UserNotFoundException("id:"+id);
		
		return user.get().getPosts();
	}
	
	@PostMapping("/jpa/users")
	public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
		User savedUser = userRepository.save(user);
		// /users/4 => /users /{id},  user.getID
		URI location = ServletUriComponentsBuilder.fromCurrentRequest()
						.path("/{id}")
						.buildAndExpand(savedUser.getId())
						.toUri();  
		
		return ResponseEntity.created(location).build();
	}
	
	@PostMapping("/jpa/users/{id}/posts")
	public ResponseEntity<Object> createPostForUser(@PathVariable int id, @Valid @RequestBody Post post) {
		Optional<User> user = userRepository.findById(id);
		
		if(user.isEmpty())
			throw new UserNotFoundException("id:"+id);
		
		post.setUser(user.get());
		
		Post savedPost = postRepository.save(post);
		
		URI location = ServletUriComponentsBuilder.fromCurrentRequest()
				.path("/{id}")
				.buildAndExpand(savedPost.getId())
				.toUri();  

		return ResponseEntity.created(location).build();
	}
}


-----------------------------------------------------------------------------------------------------------------

ê·¸ëŸ¬ë©´ userRepositoryì— findAllì„ í˜¸ì¶œí•˜ê³  ìˆëŠ”ê±°ì§€, ë¡œê·¸ì—ì„œ íŠ¹ì • ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ê²Œ ë³´ì¸ë‹¤
