

REST API를 구현할 때 중요한 것은 알맞는 응답 상태를 반환하는 것이다
localhost:8080/users/1으로 기존 사용자 정보를 조회하면 알맞는 응답이 반환된다

----------------------------------------------------------------------------------------------------------------------

🌎 http://localhost:8080/users/1 사이트화면 ==>

{
  "id": 1,
  "name": "Adam",
  "birthDate": "1994-05-22"
}

----------------------------------------------------------------------------------------------------------------------

반환되는 응답 상태는 200일 것이고, 좋다 

만약 존재하지 않는 사용자를 조회하면 어떨까?
http://localhost:8080/users/101 로 하면

----------------------------------------------------------------------------------------------------------------------


🌎 http://localhost:8080/users/101 사이트화면 ==>


Whitelabel Error Page
This application has no explicit mapping for /error, so you are seeing this as a fallback.

Wed May 22 17:38:10 KST 2024
There was an unexpected error (type=Internal Server Error, status=500).
No value present
java.util.NoSuchElementException: No value present
	at java.base/java.util.Optional.get(Optional.java:143)
	at com.in28minutes.rest.webservices.restfulwebservices.user.UserDaoService.findOne(UserDaoService.java:37)
	at com.in28minutes.rest.webservices.restfulwebservices.user.UserResource.retrieveUser(UserResource.java:28)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at........ 

----------------------------------------------------------------------------------------------------------------------

화이트라벨 에러 페이지가 표시된다
예외 추적 로그도 찍혀 있고, 좋지 않다 
이번 시간엔 이 부분을 개선해 보려고 한다

	public User findOne(int id) {
		Predicate<? super User> predicate = user -> user.getId().equals(id);
		return users.stream().filter(predicate).findFirst().get();
	}

먼저 service의 findOne() 메소드를 확인해 보는데 예외가 어디서 발생한 거지?
	at java.base/java.util.Optional.get(Optional.java:143)
Optional.get이다
바로 이 메소드에서 에러가 발생한 것이다 ( return users.stream().filter(predicate).findFirst().get(); )
조건에 맞는 항목이 없다는 것이다, 그러니 첫 번째에 해당하는 항목도 없지
이런 상황에선 이 메소드에서 예외가 발생한다 
.get()메소드 위에 마우스를 두면 정보가 나오는데
( If a value is present, returns the value, otherwise throws NoSuchElementException. )
값이 존재한다면 값을 반환하고 없다면 NoSuchElementException이 발생한다고 나와있다
이걸 잘 처리하기 위해 orElse를 붙여주겠다

----------------------------------------------------------------------------------------------------------------------



⏺ UserDaoService 클래스파일



package com.in28minutes.rest.webservices.restfulwebservices.user;

import java.time.*;
import java.util.*;
import java.util.function.*;

import org.springframework.stereotype.*;

@Component
public class UserDaoService {
    // JPA/Hibernate > Database
    // UserDaoService > Static List
	
	private static List<User> users = new ArrayList<>();
	
//	private static int usersCount = 3;
	private static int usersCount = 0;
	
	static {
		users.add(new User(++usersCount, "Adam", LocalDate.now().minusYears(30)));
		users.add(new User(++usersCount, "Eve", LocalDate.now().minusYears(25)));
		users.add(new User(++usersCount, "Jim", LocalDate.now().minusYears(20)));
	}
	
	public List<User> findAll() {
		return users;
	}
	
	public User save(User user) {
		user.setId(++usersCount);
		users.add(user);
		return user;
	}
	
	public User findOne(int id) {
		Predicate<? super User> predicate = user -> user.getId().equals(id);

    //1: 처리를 위해 .get() => .orElse()를 붙여주겠다, orElse가 하는 일이 뭐지? ( If a value is present, returns the value, otherwise returns other. ) 값이 존재한다면 값을 반환하고 없으면 우리가 정의하는 그 다른 값을 반환한다
    //그럼 여기선 orElse로 null을 반환하게 하겠다, findOne()메소드에서 null을 반환하게 된다 이러면 된 걸까? 확인해보자
		return users.stream().filter(predicate).findFirst().orElse(null);
	}
	
}

----------------------------------------------------------------------------------------------------------------------
                                                                                      |
                                                                                      V
----------------------------------------------------------------------------------------------------------------------


🌎 http://localhost:8080/users/101 사이트화면 ==>





----------------------------------------------------------------------------------------------------------------------
새로 고침을 해서 http://localhost:8080/users/101을 실행해 보면 
화면에 아무 것도 나오지 않는다
응답이 없다 

검사를 해서 확인해 보자
네트워크를 선택하고 새로고침을 하면 응답 상태는 200이다
성공은 했다고 하는데 돌아온 데이터는 없다, 이건 고쳐야겠지

